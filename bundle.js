!function e(t,i,n){function s(o,r){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return s(i?i:e)},c,c.exports,e,t,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){function n(){var e,t,i=20,n=10,o=250,r=16,l=150,h=350,c=1,d=5,y=50,u={x:220,y:380},p={x:50,y:50},m={x:100,y:0},g={x:10,y:10},f=new s(document.getElementById("main-canvas"),i,u,m),v=new s(document.getElementById("secondary-canvas"),i,u,m),_=new s(document.getElementById("next-shape-canvas"),n,p,g),x=document.getElementById("points-value"),w=[],C=0,S=this;this.init=function(){this.assignControls(),this.stepNextShape(),this.startAnimation()},this.assignControls=function(){function e(e){"38"==e.keyCode?S.moveShape("rotate"):"32"==e.keyCode?S.beginDrop():"37"==e.keyCode?S.moveShape("left"):"39"==e.keyCode&&S.moveShape("right")}document.onkeydown=e;var t=document.getElementsByClassName("move-left-btn")[0],i=document.getElementsByClassName("move-right-btn")[0],n=document.getElementsByClassName("rotate-btn")[0],s=document.getElementsByClassName("drop-btn")[0],a=document.getElementsByClassName("menu-btn")[0],o=document.getElementsByClassName("resume-btn")[0],r=document.getElementsByClassName("restart-btn")[0];t.addEventListener("touchstart",function(){S.moveShape("left")},!1),i.addEventListener("touchstart",function(){S.moveShape("right")},!1),n.addEventListener("touchstart",function(){S.moveShape("rotate")},!1),s.addEventListener("touchstart",function(){S.beginDrop()},!1),a.addEventListener("touchstart",function(){S.openMenu()},!1),a.addEventListener("click",function(){S.openMenu()},!1),o.addEventListener("touchstart",function(){S.resumeGame()},!1),o.addEventListener("click",function(){S.resumeGame()},!1),r.addEventListener("touchstart",function(){S.restartGame()},!1),r.addEventListener("click",function(){S.restartGame()},!1)},this.openMenu=function(){window.cancelAnimationFrame(S.animReq),S.showModal()},this.resumeGame=function(){S.hideModal(),S.startAnimation()},this.restartGame=function(){w=[],e=null,f.clearDisplay(),v.clearDisplay(),this.resetPoints(),S.stepNextShape(),S.resumeGame()},this.showModal=function(){var e=document.getElementsByClassName("modal-overlay")[0],t=document.getElementsByClassName("modal-container")[0];e.className=e.className.replace(/hidden/,""),t.className=t.className.replace(/hidden/,"")},this.hideModal=function(){var e=document.getElementsByClassName("modal-overlay")[0],t=document.getElementsByClassName("modal-container")[0];e.className=e.className+" hidden",t.className=t.className+" hidden"},this.getHighScore=function(){},this.startAnimation=function(){function e(e){i=Date.now(),n||(n=i),t(e)}function t(t){i-n>S.getGameSpeed()&&(n=i,S.moveShape("down")),6e4>t&&(S.animReq=window.requestAnimationFrame(e))}var i,n;S.animReq=window.requestAnimationFrame(e)},this.beginDrop=function(){e._isDropping=!0},this.getGameSpeed=function(){var t=o;return e._isDropping?t=r:e._isLanding?t=l:e._isAnimating&&(t=h),t},this.moveShape=function(t){var n,s,a={x:e._origin.x,y:e._origin.y},o=e._tiles;if("down"===t?(a.y+=i,this.updatePoints()):"left"===t?a.x-=i:"right"===t?a.x+=i:"rotate"===t&&(o=e.getRotationTiles()),borderCol=this.borderCollision(a,o),shapeCol=this.shapeCollision(a,o),borderCol||shapeCol){if("bottom"===borderCol||"down"===t&&shapeCol===!0){s=JSON.parse(JSON.stringify(w)),n=JSON.parse(JSON.stringify(e)),s.push(n);var r=this.linesToClear(s,n._origin,n._tiles);e._isDropping&&!r.linesCleared.length?(e._isDropping=!1,e._isLanding=!0):!e._isAnimating&&r.linesCleared.length?(this.animateLineClear(r.linesCleared),e._isDropping=!1,e._isLanding=!1,e._isAnimating=!0):(w=s,v.clearDisplay(),f.clearDisplay(),this.redrawSecondaryDisplay(),this.updatePoints(r.linesCleared.length),this.stepNextShape(),f.drawShape(e))}}else f.clearDisplay(),e._origin=a,e._tiles=o,f.drawShape(e)},this.stepNextShape=function(){e?e=t:(e=new a(f._drawingOrigin),f.drawShape(e)),t=new a(f._drawingOrigin),_.clearDisplay(),_.drawShape(t,!0)},this.resetPoints=function(){C=0,this.updateUIpoints()},this.updatePoints=function(e){C+=e?e*y:this.getGameSpeed()===r?d:c,this.updateUIpoints()},this.updateUIpoints=function(){for(var e=C.toString();e.length<6;)e="0"+e;x.innerHTML=e},this.shapeCollision=function(e,t){for(var n=0;n<w.length;n++)for(var s=w[n],a=0;a<s._tiles.length;a++)for(var o=s._tiles[a],r=s._origin.x+o.x*i,l=s._origin.y+o.y*i,h=0;h<t.length;h++){var c=e.x+t[h].x*i,d=e.y+t[h].y*i;if(r==c&&l==d)return!0}},this.borderCollision=function(e,t){for(var n=0,s=0,a=0,o=0;o<t.length;o++){var r=e.x+t[o].x*i,l=e.x+t[o].x*i+i,h=(e.y+t[o].y*i,e.y+t[o].y*i+i);0>r&&n>r&&(n=r),l>u.x&&l>s&&(s=l),0>r&&n>r&&(n=r),h>u.y&&h>a&&(a=h)}return s>0||0>n?"sides":a>0?"bottom":void 0},this.linesToClear=function(e,t,n){for(var s=[],a=Math.floor(u.x/i),o=[],r=0;r<n.length;r++){for(var l=!1,h=0;h<s.length;h++)t.y+n[r].y*i===s[h].lineY&&(l=!0);if(!l){var c={lineY:t.y+n[r].y*i,tilesInLine:0};s.push(c)}}for(var r=0;r<e.length;r++)for(var h=0;h<e[r]._tiles.length;h++)for(var d=e[r]._origin.y+e[r]._tiles[h].y*i,y=0;y<s.length;y++)d===s[y].lineY&&s[y].tilesInLine++;for(var r=0;r<s.length;r++)if(s[r].tilesInLine===a){var p=s[r].lineY;o.push(s[r]);for(var h=0;h<e.length;h++)for(var y=e[h]._tiles.length;y--;){var d=e[h]._origin.y+e[h]._tiles[y].y*i;p>d?e[h]._tiles[y].y+=1:d===p&&e[h]._tiles.splice(y,1)}}return{shapesArr:e,linesCleared:o}},this.animateLineClear=function(e){var t=0,n=f._ctx,s=setInterval(function(){n.fillStyle="rgba(255, 255, 255, "+t+")",n.fillRect(0,e[0].lineY,f._size.x,e.length*i),t+=.1,t>=1&&clearInterval(s)},25)},this.redrawSecondaryDisplay=function(){v.clearDisplay(),v.drawShapes(w)}}var s=e("./display"),a=e("./shape");window.onload=function(){var e=new n;e.init()}},{"./display":2,"./shape":3}],2:[function(e,t,i){function n(e,t,i,n){this._canvasEl=e,this._tileRatio=t,this._size=i,this._drawingOrigin=n,this._canvasEl.setAttribute("width",this._size.x),this._canvasEl.setAttribute("height",this._size.y),this._ctx=this._canvasEl.getContext("2d")}n.prototype.clearDisplay=function(){this._ctx.clearRect(0,0,this._canvasEl.width,this._canvasEl.height)},n.prototype.drawShape=function(e,t){var i,n=e._tiles,s=this._ctx;i=t?this._drawingOrigin:e._origin,s.fillStyle=e._color;for(var a=0;a<n.length;a++){s.fillRect(i.x+n[a].x*this._tileRatio,i.y+n[a].y*this._tileRatio,this._tileRatio,this._tileRatio);var o=i.x+n[a].x*this._tileRatio,r=i.y+n[a].y*this._tileRatio;s.strokeStyle="white",s.lineWidth=2,s.beginPath(),s.moveTo(o,r),s.lineTo(o+this._tileRatio,r),s.lineTo(o+this._tileRatio,r+this._tileRatio),s.lineTo(o+this._tileRatio,r+this._tileRatio),s.lineTo(o,r+this._tileRatio),s.closePath(),s.stroke()}},n.prototype.drawShapes=function(e){for(var t=0;t<e.length;t++)this.drawShape(e[t])},t.exports=n},{}],3:[function(e,t,i){function n(e,t){var i=[{type:"line",color:"blue",tiles:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:1,y:3}]},{type:"square",color:"green",tiles:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}]},{type:"plus",color:"red",tiles:[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}]},{type:"rightL",color:"yellow",tiles:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:2,y:2}]},{type:"leftL",color:"orange",tiles:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}]},{type:"rightS",color:"gray",tiles:[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:2}]},{type:"leftS",color:"black",tiles:[{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:2}]}],n=i[i.length*Math.random()<<0];if(this._color=n.color,this._tiles=JSON.parse(JSON.stringify(n.tiles)),this._isDropping=!1,this._isLanding=!1,this._isAnimating=!1,this._origin=e||{x:0,y:0},t){var s;this._tiles.forEach(function(e){(!s||s<e.y)&&(s=e.y)}),this._origin.y=(3-s)*t+4*-t,console.log(this._origin.y)}}n.prototype.getRotationTiles=function(){for(var e=[],t=0;t<this._tiles.length;t++){var i=this._tiles[t].x,n=this._tiles[t].y;e[t]={},e[t].x=2-n,e[t].y=i}return e},t.exports=n},{}]},{},[1]);
//# sourceMappingURL=bundle.js.map
